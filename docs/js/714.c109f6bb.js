"use strict";(self["webpackChunktest"]=self["webpackChunktest"]||[]).push([[714],{2714:function(t,a,i){i.r(a),i.d(a,{default:function(){return l}});var s=function(){var t=this;t._self._c;return t._m(0)},e=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"contanier"},[a("div",{staticClass:"canvas-wrap"},[a("div",{attrs:{id:"drawCanvas"}}),a("div",{attrs:{id:"imgCanvas"}})]),a("div",{attrs:{id:"saveCanvas"}})])}],h=(i(7658),{name:"",data(){return{wrapWidth:"",wrapHeight:"",imgCanvas:null,imgCtx:"",drawCanvas:null,drawCtx:"",saveCanvas:null,saveCtx:"",ratio:"",canvasHeight:"",canvasWidth:""}},methods:{initImgCanvas(){let t=this.wrapWidth,a=this.wrapHeight,i=this.imgWidth,s=this.imgHeight;i/s<t/a?(this.ratio=s/a,this.canvasHeight=a,this.canvasWidth=a*i/s):(this.ratio=i/t,this.canvasWidth=t,this.canvasHeight=t*s/i),this.imgCanvas.width=this.canvasWidth,this.imgCanvas.height=this.canvasHeight,this.drawCanvas.width=this.canvasWidth,this.drawCanvas.height=this.canvasHeight,this.saveCanvas.width=this.canvasWidth,this.saveCanvas.height=this.canvasHeight;let e=document.createElement("img");e.src=this.imgUrl,e.onload=()=>{console.log("图片已加载"),this.imgCtx.drawImage(e,0,0,this.canvasWidth,this.canvasHeight),this.renderDatas()}},startDraw(){this.isDrawing||(this.isDrawing=!0,this.drawCanvas.addEventListener("click",this.drawImageClickFn),this.drawCanvas.addEventListener("dblclick",this.drawImageDblClickFn),this.drawCanvas.addEventListener("mousemove",this.drawImageMoveFn))},drawImageClickFn(t){this.drawCtx;if(t.offsetX||t.layerX){let a=void 0==t.offsetX?t.layerX:t.offsetX,i=void 0==t.offsetY?t.layerY:t.offsetY,s=this.drawingPoints[this.drawingPoints.length-1]||[];s[0]===a&&s[1]===i||this.drawingPoints.push([a,i])}},drawImageMoveFn(t){let a=this.drawCtx;if(t.offsetX||t.layerX){let i=void 0==t.offsetX?t.layerX:t.offsetX,s=void 0==t.offsetY?t.layerY:t.offsetY;a.clearRect(0,0,this.canvasWidth,this.canvasHeight),a.fillStyle="blue",this.drawingPoints.forEach(((t,i)=>{a.beginPath(),a.arc(...t,6,0,180),a.fill()})),a.save(),a.beginPath(),this.drawingPoints.forEach(((t,i)=>{a.lineTo(...t)})),a.lineTo(i,s),a.lineWidth="3",a.strokeStyle="blue",a.fillStyle="rgba(255, 0, 0, 0.3)",a.stroke(),a.fill(),a.restore()}},drawImageDblClickFn(t){let a=this.drawCtx;this.saveCtx;if(t.offsetX||t.layerX){let a=void 0==t.offsetX?t.layerX:t.offsetX,i=void 0==t.offsetY?t.layerY:t.offsetY,s=this.drawingPoints[this.drawingPoints.length-1]||[];s[0]===a&&s[1]===i||this.drawingPoints.push([a,i])}a.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.drawSaveArea(this.drawingPoints),this.drawedPoints.push(this.drawingPoints),this.drawingPoints=[],this.isDrawing=!1,this.drawCanvas.removeEventListener("click",this.drawImageClickFn),this.drawCanvas.removeEventListener("dblclick",this.drawImageDblClickFn),this.drawCanvas.removeEventListener("mousemove",this.drawImageMoveFn)},drawSaveArea(t){0!==t.length&&(this.saveCtx.save(),this.saveCtx.beginPath(),t.forEach(((t,a)=>{this.saveCtx.lineTo(...t)})),this.saveCtx.closePath(),this.saveCtx.lineWidth="2",this.saveCtx.fillStyle="rgba(255,0, 255, 0.3)",this.saveCtx.strokeStyle="red",this.saveCtx.stroke(),this.saveCtx.fill(),this.saveCtx.restore())},savePoints(){let t=[];t=this.drawedPoints.map((t=>{let a={};return t.forEach(((t,i)=>{a[`x${i+1}`]=Math.round(t[0]*this.ratio),a[`y${i+1}`]=Math.round(t[1]*this.ratio)})),{polygon:a}})),this.submitData=t,console.log("最终提交数据",t)},renderDatas(){this.drawedPoints=this.submitData.map((t=>{let a=t.polygon,i=[];for(let s=1;s<Object.keys(a).length/2+1;s++)isNaN(a[`x${s}`])||isNaN(a[`y${s}`])||i.push([a[`x${s}`]/this.ratio,a[`y${s}`]/this.ratio]);return this.drawSaveArea(i),i}))}}}),n=h,r=i(3736),d=(0,r.Z)(n,s,e,!1,null,"a226e25e",null),l=d.exports}}]);
//# sourceMappingURL=714.c109f6bb.js.map